import{r as v,m as I,f as L,s as j,o as a,c as o,a as i,t as f,F as _,n as S,p as T,d as E,v as U,q as R,_ as A,x as Y,y as q,b as w,w as D,z as V}from"./entry.DWkAmXMp.js";import{_ as M}from"./nuxt-link.DWPtTnMg.js";import{g as z}from"./youtubeHelper.D5UyPOWT.js";import{u as F}from"./useSearchStore.DyOQswZJ.js";const G=window.setInterval,O={class:"aspect-w-16 aspect-h-9 relative"},W=["src"],H=["id"],J={__name:"YouTubePlayer",props:{videoId:{type:String,required:!0}},emits:["timeUpdate","stateChange"],setup(l,{expose:y,emit:u}){const m=l,s=u,t=v(`youtube-player-${Math.random().toString(36).substr(2,9)}`),e=v(!1);let n=null;const d=()=>new Promise(r=>{if(window.YT&&window.YT.Player)r(window.YT);else{const h=document.createElement("script");h.src="https://www.youtube.com/iframe_api";const k=document.getElementsByTagName("script")[0];k.parentNode.insertBefore(h,k),window.onYouTubeIframeAPIReady=()=>r(window.YT)}}),g=r=>{n=new r.Player(t.value,{height:"100%",width:"100%",videoId:m.videoId,playerVars:{autoplay:0,modestbranding:1,rel:0,origin:window.location.origin},events:{onReady:x,onStateChange:p}})},x=r=>{s("stateChange","ready")},p=r=>{switch(r.data){case YT.PlayerState.UNSTARTED:s("stateChange","unstarted");break;case YT.PlayerState.ENDED:s("stateChange","ended");break;case YT.PlayerState.PLAYING:s("stateChange","playing");break;case YT.PlayerState.PAUSED:s("stateChange","paused");break;case YT.PlayerState.BUFFERING:s("stateChange","buffering");break;case YT.PlayerState.CUED:s("stateChange","cued");break}},C=()=>{if(n&&n.getCurrentTime){const r=n.getCurrentTime();s("timeUpdate",{minutes:Math.floor(r/60),seconds:Math.floor(r%60)})}},b=async()=>{e.value=!0;const r=await d();g(r)},P=r=>{n&&n.seekTo&&n.seekTo(r)};I(()=>{b()});let c=null;return L(()=>m.videoId,r=>{n&&n.loadVideoById&&n.loadVideoById(r)}),I(()=>{c=G(C,100)}),j(()=>{n&&n.destroy&&n.destroy(),c&&clearInterval(c)}),y({seekTo:P}),(r,h)=>(a(),o("div",O,[e.value?(a(),o("div",{key:1,id:t.value,class:"w-full h-full"},null,8,H)):(a(),o("img",{key:0,src:`https://img.youtube.com/vi/${l.videoId}/0.jpg`,onClick:b,class:"w-full h-full object-cover cursor-pointer"},null,8,W))]))}},K={class:"text-sm text-gray-500 dark:text-gray-400 mr-2 flex-shrink-0 w-16 text-right content-center"},Q={class:"lyrics-line flex-grow"},X={key:0},Z={__name:"LyricLine",props:{line:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},emits:["seek"],setup(l,{emit:y}){const u=(s,t)=>{const e=[];return s.split("//").forEach((d,g)=>{const x=t==null?void 0:t.find(p=>p.text===d);x?e.push({text:d,furigana:x.reading}):e.push({text:d})}),e},m=s=>{const t=s.minutes.toString().padStart(2,"0"),e=s.seconds.toString().padStart(2,"0");return`[${t}:${e}]`};return(s,t)=>(a(),o("div",{class:U([{"font-bold text-blue-600 dark:text-blue-400":l.isActive,"text-gray-700 dark:text-gray-300":!l.isActive},"flex transition-all duration-300 ease-in-out leading-relaxed cursor-pointer"]),onClick:t[0]||(t[0]=e=>s.$emit("seek",l.line.time))},[i("span",K,f(m(l.line.time)),1),i("div",Q,[(a(!0),o(_,null,S(u(l.line.text,l.line.furigana),(e,n)=>(a(),o("ruby",{key:n},[e.furigana?(a(),o("rt",X,f(e.furigana),1)):T("",!0),E(" "+f(e.text),1)]))),128))])],2))}},ee={key:0,class:"space-y-2 text-base sm:text-lg"},te={key:1,class:"text-gray-600 dark:text-gray-400"},se={__name:"LyricsDisplay",props:{lyrics:{type:Array,default:()=>[]},currentTime:{type:Object,required:!0}},emits:["seekTo"],setup(l,{emit:y}){const u=l,m=s=>{const t=u.currentTime.minutes*60+u.currentTime.seconds,e=s.time.minutes*60+s.time.seconds,n=e+s.time.length;return t>=e&&t<n};return(s,t)=>(a(),o("div",null,[t[1]||(t[1]=i("h2",{class:"text-2xl sm:text-3xl font-semibold mb-6 text-gray-800 dark:text-gray-200"},"Lyrics",-1)),l.lyrics&&l.lyrics.length>0?(a(),o("div",ee,[(a(!0),o(_,null,S(l.lyrics,(e,n)=>(a(),R(Z,{key:n,line:e,isActive:m(e),onSeek:t[0]||(t[0]=d=>s.$emit("seekTo",d))},null,8,["line","isActive"]))),128))])):(a(),o("div",te," No lyrics available. "))]))}},ne={key:0,class:"bg-black bg-opacity-50 text-white p-2 text-center"},re={class:"text-lg font-semibold lyrics-line"},ae={key:0},oe={key:1},ie={__name:"CurrentLyrics",props:{lyrics:{type:Array,required:!0},currentTime:{type:Object,required:!0}},setup(l){const y=l,u=Y(()=>{const s=y.currentTime.minutes*60+y.currentTime.seconds;return y.lyrics.find(t=>{const e=t.time.minutes*60+t.time.seconds,n=e+t.time.length;return s>=e&&s<n})}),m=(s,t)=>{const e=[];return s.split("//").forEach((d,g)=>{const x=t==null?void 0:t.find(p=>p.text===d);x?e.push({text:d,furigana:x.reading}):e.push({text:d})}),e};return(s,t)=>u.value?(a(),o("div",ne,[i("p",re,[(a(!0),o(_,null,S(m(u.value.text,u.value.furigana),(e,n)=>(a(),o(_,{key:n},[e.furigana?(a(),o("ruby",ae,[i("rt",null,f(e.furigana),1),E(" "+f(e.text),1)])):(a(),o("span",oe,f(e.text),1))],64))),128))])])):T("",!0)}},le=A(ie,[["__scopeId","data-v-342bcb40"]]),ce={key:0,class:"px-4 py-8"},ue={class:"text-2xl sm:text-3xl font-bold mb-2 text-center text-blue-600 dark:text-blue-400"},de={class:"text-lg sm:text-xl font-semibold mb-4 text-center text-gray-600 dark:text-gray-400"},ye={class:"mb-8 max-w-3xl mx-auto relative"},me={class:"absolute bottom-12 left-0 right-0"},ge={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 sm:p-6 mb-4 max-w-3xl mx-auto"},xe={key:1,class:"text-center text-gray-600 dark:text-gray-400"},fe={key:2,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg max-w-3xl mx-auto"},he={class:"list-disc list-inside space-y-1"},pe=["href"],ve={class:"text-center space-x-4 flex justify-center items-center mt-8"},_e=["href"],be={__name:"song",setup(l){const y=q(),u=v({minutes:0,seconds:0}),{songs:m,fetchSongs:s}=F(),t=v([]),e=v([]),n=v(null),d=V(),g=Y(()=>m.value.find(c=>c.videoId===y.query.id)),x=Y(()=>g.value?z(g.value.videoId):""),p=async c=>{try{const h=await(await fetch(`${d.app.baseURL}lyrics/${c}.json`)).json();t.value=h.lyrics,e.value=h.references||[]}catch{t.value=[],e.value=[]}};I(async()=>{await s()}),L(()=>y.query.id,async c=>{c&&await p(c)},{immediate:!0});const C=c=>{u.value=c},b=c=>{},P=c=>{if(n.value){const r=c.minutes*60+c.seconds;n.value.seekTo(r)}};return(c,r)=>{const h=J,k=se,B=M;return g.value?(a(),o("div",ce,[i("h1",ue,f(g.value.title),1),i("h2",de,f(g.value.artist),1),i("div",ye,[w(h,{videoId:g.value.videoId,onTimeUpdate:C,onStateChange:b,ref_key:"youtubePlayer",ref:n},null,8,["videoId"]),i("div",me,[w(le,{lyrics:t.value,currentTime:u.value},null,8,["lyrics","currentTime"])])]),t.value.length>0?(a(),o("div",ge,[w(k,{lyrics:t.value,currentTime:u.value,onSeekTo:P},null,8,["lyrics","currentTime"])])):(a(),o("div",xe," No lyrics found. ")),e.value.length>0?(a(),o("div",fe,[r[0]||(r[0]=i("h3",{class:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200"},"References",-1)),i("ul",he,[(a(!0),o(_,null,S(e.value,($,N)=>(a(),o("li",{key:N,class:"text-sm text-gray-600 dark:text-gray-300"},[i("a",{href:$.url,target:"_blank",rel:"noopener noreferrer",class:"text-blue-500 hover:underline"},f($.description||$.url),9,pe)]))),128))])])):T("",!0),i("div",ve,[w(B,{to:"/",class:"inline-flex items-center justify-center bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition duration-300",title:"Back to Song Gallery"},{default:D(()=>r[1]||(r[1]=[i("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1}),i("a",{href:x.value,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center justify-center bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition duration-300",title:"Watch on YouTube"},r[2]||(r[2]=[i("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})],-1)]),8,_e)])])):T("",!0)}}},Ce=A(be,[["__scopeId","data-v-34720f0f"]]);export{Ce as default};
