import{r as v,m as I,f as L,s as B,o as r,c as a,a as i,t as h,F as b,n as C,p as S,d as E,v as N,q as j,x as Y,_ as U,y as R,b as T,w as q,z as D}from"./entry.CoLsirPJ.js";import{_ as V}from"./nuxt-link.C6shpcwk.js";import{g as M}from"./youtubeHelper.D5UyPOWT.js";import{u as z}from"./useSearchStore.BUuIX0ek.js";const F=window.setInterval,G={class:"aspect-w-16 aspect-h-9 relative"},O=["src"],W=["id"],H={__name:"YouTubePlayer",props:{videoId:{type:String,required:!0}},emits:["timeUpdate","stateChange"],setup(l,{expose:m,emit:c}){const g=l,s=c,t=v(`youtube-player-${Math.random().toString(36).substr(2,9)}`),e=v(!1);let n=null;const y=()=>new Promise(o=>{if(window.YT&&window.YT.Player)o(window.YT);else{const _=document.createElement("script");_.src="https://www.youtube.com/iframe_api";const w=document.getElementsByTagName("script")[0];w.parentNode.insertBefore(_,w),window.onYouTubeIframeAPIReady=()=>o(window.YT)}}),x=o=>{n=new o.Player(t.value,{height:"100%",width:"100%",videoId:g.videoId,playerVars:{autoplay:0,modestbranding:1,rel:0,origin:window.location.origin},events:{onReady:f,onStateChange:p}})},f=o=>{s("stateChange","ready")},p=o=>{switch(o.data){case YT.PlayerState.UNSTARTED:s("stateChange","unstarted");break;case YT.PlayerState.ENDED:s("stateChange","ended");break;case YT.PlayerState.PLAYING:s("stateChange","playing");break;case YT.PlayerState.PAUSED:s("stateChange","paused");break;case YT.PlayerState.BUFFERING:s("stateChange","buffering");break;case YT.PlayerState.CUED:s("stateChange","cued");break}},P=()=>{if(n&&n.getCurrentTime){const o=n.getCurrentTime();s("timeUpdate",{minutes:Math.floor(o/60),seconds:Math.floor(o%60)})}},k=async()=>{e.value=!0;const o=await y();x(o)},u=o=>{n&&n.seekTo&&n.seekTo(o)};I(()=>{k()});let d=null;return L(()=>g.videoId,o=>{n&&n.loadVideoById&&n.loadVideoById(o)}),I(()=>{d=F(P,100)}),B(()=>{n&&n.destroy&&n.destroy(),d&&clearInterval(d)}),m({seekTo:u}),(o,_)=>(r(),a("div",G,[e.value?(r(),a("div",{key:1,id:t.value,class:"w-full h-full"},null,8,W)):(r(),a("img",{key:0,src:`https://img.youtube.com/vi/${l.videoId}/0.jpg`,onClick:k,class:"w-full h-full object-cover cursor-pointer"},null,8,O))]))}},J={class:"text-sm text-gray-500 dark:text-gray-400 mr-2 flex-shrink-0 w-16 text-right content-center"},K={class:"lyrics-line flex-grow"},Q={key:0},X={__name:"LyricLine",props:{line:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},emits:["seek"],setup(l,{emit:m}){const c=(s,t)=>{const e=[];return s.split("//").forEach((y,x)=>{const f=t==null?void 0:t.find(p=>p.text===y);f?e.push({text:y,furigana:f.reading}):e.push({text:y})}),e},g=s=>{const t=s.minutes.toString().padStart(2,"0"),e=s.seconds.toString().padStart(2,"0");return`[${t}:${e}]`};return(s,t)=>(r(),a("div",{class:N([{"font-bold text-blue-600 dark:text-blue-400":l.isActive,"text-gray-700 dark:text-gray-300":!l.isActive},"flex transition-all duration-300 ease-in-out leading-relaxed cursor-pointer"]),onClick:t[0]||(t[0]=e=>s.$emit("seek",l.line.time))},[i("span",J,h(g(l.line.time)),1),i("div",K,[(r(!0),a(b,null,C(c(l.line.text,l.line.furigana),(e,n)=>(r(),a("ruby",{key:n},[e.furigana?(r(),a("rt",Q,h(e.furigana),1)):S("",!0),E(" "+h(e.text),1)]))),128))])],2))}},Z={key:0,class:"space-y-2 text-base sm:text-lg"},ee={key:1,class:"text-gray-600 dark:text-gray-400"},te={__name:"LyricsDisplay",props:{lyrics:{type:Array,default:()=>[]},currentTime:{type:Object,required:!0}},emits:["seekTo"],setup(l,{emit:m}){const c=l,g=s=>{const t=c.currentTime.minutes*60+c.currentTime.seconds,e=s.time.minutes*60+s.time.seconds,n=e+s.time.length;return t>=e&&t<n};return(s,t)=>(r(),a("div",null,[t[1]||(t[1]=i("h2",{class:"text-2xl sm:text-3xl font-semibold mb-6 text-gray-800 dark:text-gray-200"},"Lyrics",-1)),l.lyrics&&l.lyrics.length>0?(r(),a("div",Z,[(r(!0),a(b,null,C(l.lyrics,(e,n)=>(r(),j(X,{key:n,line:e,isActive:g(e),onSeek:t[0]||(t[0]=y=>s.$emit("seekTo",y))},null,8,["line","isActive"]))),128))])):(r(),a("div",ee," No lyrics available. "))]))}},se={key:0,class:"bg-black bg-opacity-50 text-white p-2 text-center"},ne={class:"text-lg font-semibold lyrics-line"},re={key:0},oe={key:1},ae={__name:"CurrentLyrics",props:{lyrics:{type:Array,required:!0},currentTime:{type:Object,required:!0}},setup(l){const m=l,c=Y(()=>{const s=m.currentTime.minutes*60+m.currentTime.seconds;return m.lyrics.find(t=>{const e=t.time.minutes*60+t.time.seconds,n=e+t.time.length;return s>=e&&s<n})}),g=(s,t)=>{const e=[];return s.split("//").forEach((y,x)=>{const f=t==null?void 0:t.find(p=>p.text===y);f?e.push({text:y,furigana:f.reading}):e.push({text:y})}),e};return(s,t)=>c.value?(r(),a("div",se,[i("p",ne,[(r(!0),a(b,null,C(g(c.value.text,c.value.furigana),(e,n)=>(r(),a(b,{key:n},[e.furigana?(r(),a("ruby",re,[i("rt",null,h(e.furigana),1),E(" "+h(e.text),1)])):(r(),a("span",oe,h(e.text),1))],64))),128))])])):S("",!0)}},ie={key:0,class:"px-4 py-8"},le={class:"text-2xl sm:text-3xl font-bold mb-2 text-center text-blue-600 dark:text-blue-400"},ce={class:"text-lg sm:text-xl font-semibold mb-4 text-center text-gray-600 dark:text-gray-400"},ue={class:"mb-8 max-w-3xl mx-auto relative"},de={class:"absolute bottom-12 left-0 right-0"},ye={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 sm:p-6 mb-4 max-w-3xl mx-auto"},me={key:1,class:"text-center text-gray-600 dark:text-gray-400"},ge={key:2,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg max-w-3xl mx-auto"},xe={class:"list-disc list-inside space-y-1"},fe=["href"],he={class:"text-center space-x-4 flex justify-center items-center mt-8"},pe=["href"],ve={__name:"song",setup(l){const m=R(),c=v({minutes:0,seconds:0}),{songs:g,fetchSongs:s}=z(),t=v([]),e=v([]),n=v(null),y=D(),x=Y(()=>g.value.find(u=>u.videoId===m.query.id)),f=Y(()=>x.value?M(x.value.videoId):""),p=async u=>{try{const o=await(await fetch(`${y.app.baseURL}lyrics/${u}.json`)).json();t.value=o.lyrics,e.value=o.references||[]}catch{t.value=[],e.value=[]}};I(async()=>{await s()}),L(()=>m.query.id,async u=>{u&&await p(u)},{immediate:!0});const P=u=>{c.value=u},k=u=>{if(n.value){const d=u.minutes*60+u.seconds;n.value.seekTo(d)}};return(u,d)=>{const o=H,_=te,w=V;return x.value?(r(),a("div",ie,[i("h1",le,h(x.value.title),1),i("h2",ce,h(x.value.artist),1),i("div",ue,[T(o,{videoId:x.value.videoId,onTimeUpdate:P,ref_key:"youtubePlayer",ref:n},null,8,["videoId"]),i("div",de,[T(ae,{lyrics:t.value,currentTime:c.value},null,8,["lyrics","currentTime"])])]),t.value.length>0?(r(),a("div",ye,[T(_,{lyrics:t.value,currentTime:c.value,onSeekTo:k},null,8,["lyrics","currentTime"])])):(r(),a("div",me," No lyrics found. ")),e.value.length>0?(r(),a("div",ge,[d[0]||(d[0]=i("h3",{class:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200"},"References",-1)),i("ul",xe,[(r(!0),a(b,null,C(e.value,($,A)=>(r(),a("li",{key:A,class:"text-sm text-gray-600 dark:text-gray-300"},[i("a",{href:$.url,target:"_blank",rel:"noopener noreferrer",class:"text-blue-500 hover:underline"},h($.description||$.url),9,fe)]))),128))])])):S("",!0),i("div",he,[T(w,{to:"/",class:"inline-flex items-center justify-center bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition duration-300",title:"Back to Song Gallery"},{default:q(()=>d[1]||(d[1]=[i("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1}),i("a",{href:f.value,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center justify-center bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition duration-300",title:"Watch on YouTube"},d[2]||(d[2]=[i("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})],-1)]),8,pe)])])):S("",!0)}}},Te=U(ve,[["__scopeId","data-v-a5f6be5e"]]);export{Te as default};
