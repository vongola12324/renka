import{r as f,m as S,f as B,s as j,o as r,c as o,_ as A,a as l,t as p,F as C,n as L,p as $,d as N,v as R,q as V,x as M,y as P,b as I,w as U,z as q}from"./entry.LRsCZqu7.js";import{_ as E}from"./nuxt-link.BvCaIXdI.js";import{g as z}from"./youtubeHelper.D5UyPOWT.js";import{u as D}from"./useSearchStore.DGne440Y.js";const F=window.setInterval,O={class:"aspect-w-16 aspect-h-9 relative"},G=["src"],W=["id"],H={__name:"YouTubePlayer",props:{videoId:{type:String,required:!0}},emits:["timeUpdate"],setup(i,{expose:g,emit:d}){const x=i,a=d,e=f(`youtube-player-${Math.random().toString(36).substr(2,9)}`),t=f(!1);let s=null;const m=()=>new Promise(n=>{if(window.YT&&window.YT.Player)n(window.YT);else{const _=document.createElement("script");_.src="https://www.youtube.com/iframe_api";const b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(_,b),window.onYouTubeIframeAPIReady=()=>n(window.YT)}}),y=n=>{s=new n.Player(e.value,{height:"100%",width:"100%",videoId:x.videoId,playerVars:{autoplay:0,modestbranding:1,rel:0,origin:window.location.origin},events:{onReady:v,onStateChange:h}})},v=n=>{},h=n=>{},k=()=>{if(s&&s.getCurrentTime){const n=s.getCurrentTime();a("timeUpdate",{minutes:Math.floor(n/60),seconds:Math.floor(n%60)})}},w=async()=>{t.value=!0;const n=await m();y(n)},c=n=>{s&&s.seekTo&&s.seekTo(n)};S(()=>{w()});let u=null;return B(()=>x.videoId,n=>{s&&s.loadVideoById&&s.loadVideoById(n)}),S(()=>{u=F(k,100)}),j(()=>{s&&s.destroy&&s.destroy(),u&&clearInterval(u)}),g({seekTo:c}),(n,_)=>(r(),o("div",O,[t.value?(r(),o("div",{key:1,id:e.value,class:"w-full h-full"},null,8,W)):(r(),o("img",{key:0,src:`https://img.youtube.com/vi/${i.videoId}/0.jpg`,onClick:w,class:"w-full h-full object-cover cursor-pointer"},null,8,G))]))}},J={class:"text-sm text-gray-500 dark:text-gray-400 mr-2 flex-shrink-0 w-16 text-right content-center"},K={class:"lyrics-line flex-grow"},Q={key:0},X={__name:"LyricLine",props:{line:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},emits:["seek"],setup(i,{emit:g}){const d=(a,e)=>{const t=[];return a.split("//").forEach((m,y)=>{const v=e==null?void 0:e.find(h=>h.text===m);v?t.push({text:m,furigana:v.reading}):t.push({text:m})}),t},x=a=>{const e=a.minutes.toString().padStart(2,"0"),t=a.seconds.toString().padStart(2,"0");return`[${e}:${t}]`};return(a,e)=>(r(),o("div",{class:R([{"font-bold text-blue-600 dark:text-blue-400":i.isActive,"text-gray-700 dark:text-gray-300":!i.isActive},"flex transition-all duration-300 ease-in-out leading-relaxed cursor-pointer"]),onClick:e[0]||(e[0]=t=>a.$emit("seek",i.line.time))},[l("span",J,p(x(i.line.time)),1),l("div",K,[(r(!0),o(C,null,L(d(i.line.text,i.line.furigana),(t,s)=>(r(),o("ruby",{key:s},[t.furigana?(r(),o("rt",Q,p(t.furigana),1)):$("",!0),N(" "+p(t.text),1)]))),128))])],2))}},Z=A(X,[["__scopeId","data-v-a3e7991b"]]),ee={key:0,class:"space-y-2 text-base sm:text-lg"},te={key:1,class:"text-gray-600 dark:text-gray-400"},se={__name:"LyricsDisplay",props:{lyrics:{type:Array,default:()=>[]},currentTime:{type:Object,required:!0}},emits:["seekTo"],setup(i,{emit:g}){const d=i,x=a=>{const e=d.currentTime.minutes*60+d.currentTime.seconds,t=a.time.minutes*60+a.time.seconds,s=t+a.time.length;return e>=t&&e<s};return(a,e)=>(r(),o("div",null,[e[1]||(e[1]=l("h2",{class:"text-2xl sm:text-3xl font-semibold mb-6 text-gray-800 dark:text-gray-200"},"Lyrics",-1)),i.lyrics&&i.lyrics.length>0?(r(),o("div",ee,[(r(!0),o(C,null,L(i.lyrics,(t,s)=>(r(),V(Z,{key:s,line:t,isActive:x(t),onSeek:e[0]||(e[0]=m=>a.$emit("seekTo",m))},null,8,["line","isActive"]))),128))])):(r(),o("div",te," No lyrics available. "))]))}},ne={key:0,class:"px-4 py-8"},re={class:"text-2xl sm:text-3xl font-bold mb-2 text-center text-blue-600 dark:text-blue-400"},oe={class:"text-lg sm:text-xl font-semibold mb-4 text-center text-gray-600 dark:text-gray-400"},ae={class:"mb-8 max-w-3xl mx-auto"},ie={key:0,class:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-4 sm:p-6 mb-4 max-w-3xl mx-auto"},le={key:1,class:"text-center text-gray-600 dark:text-gray-400"},ce={key:2,class:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg max-w-3xl mx-auto"},ue={class:"list-disc list-inside space-y-1"},de=["href"],me={class:"text-center space-x-4 flex justify-center items-center mt-8"},ye=["href"],pe={__name:"song",setup(i){const g=M(),d=f({minutes:0,seconds:0}),{songs:x,fetchSongs:a}=D(),e=f([]),t=f([]),s=f(null),m=q(),y=P(()=>x.value.find(c=>c.videoId===g.query.id)),v=P(()=>y.value?z(y.value.videoId):""),h=async c=>{try{const n=await(await fetch(`${m.app.baseURL}lyrics/${c}.json`)).json();e.value=n.lyrics,t.value=n.references||[]}catch{e.value=[],t.value=[]}};S(async()=>{await a()}),B(()=>g.query.id,async c=>{c&&await h(c)},{immediate:!0});const k=c=>{d.value=c},w=c=>{if(s.value){const u=c.minutes*60+c.seconds;s.value.seekTo(u)}};return(c,u)=>{const n=H,_=se,b=E;return y.value?(r(),o("div",ne,[l("h1",re,p(y.value.title),1),l("h2",oe,p(y.value.artist),1),l("div",ae,[I(n,{videoId:y.value.videoId,onTimeUpdate:k,ref_key:"youtubePlayer",ref:s},null,8,["videoId"])]),e.value.length>0?(r(),o("div",ie,[I(_,{lyrics:e.value,currentTime:d.value,onSeekTo:w},null,8,["lyrics","currentTime"])])):(r(),o("div",le," Loading lyrics... ")),t.value.length>0?(r(),o("div",ce,[u[0]||(u[0]=l("h3",{class:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200"},"References",-1)),l("ul",ue,[(r(!0),o(C,null,L(t.value,(T,Y)=>(r(),o("li",{key:Y,class:"text-sm text-gray-600 dark:text-gray-300"},[l("a",{href:T.url,target:"_blank",rel:"noopener noreferrer",class:"text-blue-500 hover:underline"},p(T.description||T.url),9,de)]))),128))])])):$("",!0),l("div",me,[I(b,{to:"/",class:"inline-flex items-center justify-center bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition duration-300",title:"Back to Song Gallery"},{default:U(()=>u[1]||(u[1]=[l("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1}),l("a",{href:v.value,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center justify-center bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition duration-300",title:"Watch on YouTube"},u[2]||(u[2]=[l("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})],-1)]),8,ye)])])):$("",!0)}}};export{pe as default};
